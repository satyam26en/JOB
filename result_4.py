# -*- coding: utf-8 -*-
"""result_4.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1VUZ2RO5FkMfv2RtL8ILyufZDc2mwwJn4
"""

import pandas as pd
import plotly.express as px
import streamlit as st

# Load the dataset from the provided GitHub URL
file_url = "https://raw.githubusercontent.com/satyam26en/JOB/main/Clean_Job_File.csv"
df = pd.read_csv(file_url)

df['company'] = df['company'].fillna('').str.strip()
df['experience_category'] = df['experience_category'].fillna('').str.strip()

def filter_experience_level(df, experience_level):
    if experience_level != 'All':
        df = df[df['experience_category'] == experience_level]
    return df

def get_top_companies(df, experience_level='All'):
    df_filtered = filter_experience_level(df, experience_level)
    print(f"Data for {experience_level} experience level:")  # Debug statement
    print(df_filtered.head())  # Print the filtered data to check
    top_companies = df_filtered['company'].value_counts().reset_index()
    top_companies.columns = ['Company', 'Number of Openings']
    top_companies = top_companies.head(10)
    return top_companies

st.title('Top Hiring Companies Based on Number of Job Openings')

experience_level = st.selectbox(
    'Select Experience Level',
    ['All', 'Fresher', 'Junior', 'Mid-Level', 'Senior', 'Expert'],
    index=0
)

top_companies = get_top_companies(df, experience_level)
fig = px.bar(
    top_companies,
    x='Company',
    y='Number of Openings',
    title=f'Top Hiring Companies Based on Number of Job Openings ({experience_level})',
    labels={'Company': 'Company', 'Number of Openings': 'Number of Openings'},
    color='Company',
    color_discrete_sequence=px.colors.qualitative.Pastel,
    custom_data=['Company']
)

yaxis_settings = {
    'All': {'tickvals': [0, 500, 1000, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000, 5500], 'range': [0, 6000]},
    'Fresher': {'tickvals': [0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000], 'range': [0, 1100]},
    'Junior': {'tickvals': [0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000], 'range': [0, 1100]},
    'Mid-Level': {'tickvals': [0, 200, 400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000], 'range': [0, 2200]},
    'Senior': {'tickvals': [0, 200, 400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000], 'range': [0, 2200]},
    'Expert': {'tickvals': [0, 50, 100, 150, 200, 250, 300, 350, 400, 450, 500], 'range': [0, 550]}
}

fig.update_layout(
    title={
        'text': f'Top Hiring Companies Based on Number of Job Openings ({experience_level})',
        'y': 0.9,
        'x': 0.5,
        'xanchor': 'center',
        'yanchor': 'top'
    },
    xaxis_title='Company',
    yaxis_title='Number of Openings',
    uniformtext_minsize=8,
    uniformtext_mode='hide',
    showlegend=False,
    yaxis=dict(
        tickmode='array',
        tickvals=yaxis_settings[experience_level]['tickvals'],
        range=yaxis_settings[experience_level]['range'],
        title='Number of Openings',
        linecolor='black', linewidth=2, mirror=True
    ),
    plot_bgcolor='white',
    paper_bgcolor='white',
    margin=dict(l=50, r=50, b=100, t=100, pad=4),
    xaxis=dict(linecolor='black', linewidth=2, mirror=True),
    width=1000,
    height=600
)

fig.update_traces(hovertemplate='%{customdata[0]}<br>Number of Openings: %{y}')

st.plotly_chart(fig)